<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="/res/public/layui/css/layui.css"  media="all">
    <link rel="stylesheet" type="text/css" href="/res/css/style.css"/>
    <script src="/res/js/jquery-3.1.1.min.js"></script>
    <script src="/res/public/layui/layui.js"></script>
    <script src="/res/public/layPage/laypage.js"></script>
    <script src="/res/public/layui/Area1.js" type="text/javascript"></script>
    <script src="/res/js/rg-validator-1.1.js"></script>
    <style type="text/css">
        input[disabled]::-webkit-input-placeholder{ 
        color: #666; 
        } 
        input:-moz-placeholder{ 
        color: #666; 
        } 
        input::-moz-placeholder{ 
        color: #666; 
        } 
        input:-ms-input-placeholder{ 
        color: #666; 
        }
    </style>
</head>
<body>
<section id="itocCenter">
    <section class="itocContent">
        <div class="itocMain">
            <div style="width:100%;box-sizing:border-box;padding:0 20px;margin-right:20px; margin-top:10px;">
                <form id="distributor_basic_frm" class="layui-form jun-form-s form-css" method="post">
                    <div>
                        <h3 class="bg-f0 h3-tittle pl10 mt20">基本信息</h3>
                        <blockquote class="layui-elem-quote layui-quote-nm layui-elem-bor">
                            <div style="padding-left: 40px;">
                                <dl class="dl-form mt5">
                                    <dt class="flt fz12"><span class="c-f">*</span>公司名称：</dt>
                                    <dd class="flt layui-form rg_group">
                                       <input type="text" name="companyName" rg-validate-field="companyName"  placeholder="请输入公司名称" autocomplete="off" class="layui-input" value="">
                                    </dd>
                                    <dt class="flt fz12 ml20 pl20 "><span class="c-f">*</span>社会信用代码：</dt>
                                    <dd class="flt layui-form rg_group">
                                       <input type="text" name="inteSocialCreditNo" rg-validate-field="inteSocialCreditNo"  placeholder="请输入15或18位社会信用代码" autocomplete="off" class="layui-input" value="">
                                    </dd>
                                   <!--  <dd class="flt fz12 ml20">
                                        <span class="c-f" style="line-height:32px;">与分销商库中分销商存在冲突</span>
                                        <a class="c-h cs-p ml10 fz12">查看冲突</a>
                                    </dd> -->
                                </dl>
                                <dl class="dl-form mt5">
                                    <dt class="flt fz12" style="width: 115px;margin-left:-25px;">座机：</dt>
                                    <dd class="flt rg_group "><input type="text" name="telephone" rg-validate-field="telephone" placeholder="格式：027-88888888" autocomplete="off" class="layui-input"></dd>
                                    <dt class="flt fz12" style="width: 130px;"><span class="c-f">*</span>区域：</dt>
                                    <dd class="flt rg_group ">
                                        <select name="district" rg-validate-field="district" lay-filter="district" id="district" lay-search>
                                            <option value="" selected="">请选区域</option>
                                            <option value="1">北区</option>
                                            <option value="2">南区</option>
                                            <option value="3">中区</option>
                                        </select>
                                    </dd>
                                </dl>
                                <dl class="dl-form mt5">
                                    <dt class="flt fz12" style="width: 115px;margin-left:-25px;"><span class="c-f">*</span>客户经理：</dt>
                                    <dd class="flt rg_group ">
                                        <select name="accountManager" rg-validate-field="accountManager" lay-filter="accountManager" id="accountManager" lay-search>
                                            <option value="">请选择</option>
                                        </select>
                                    </dd>
                                    <dt class="flt fz12" style="width: 130px;"><span class="c-f">*</span>销售代表：</dt>
                                    <dd class="flt layui-form jun-form-l rg_group">
                                        <select name="sales" rg-validate-field="sales" lay-filter="sales" id="sales" lay-search>
                                            <option value="">请选择</option>
                                        </select>
                                    </dd>
                                </dl>
                                <dl class="dl-form" style="margin-bottom:10px;">
                                    <dt class="flt" style="width: 115px;margin-left:-25px;"><span class="c-f">*</span>地址：</dt>
                                    <dd class="flt pre layui-form dd-city rg_group">
                                        <select name="province" rg-validate-field="province" lay-filter="province" id="s_province" lay-search>
                                            <option value="">请选择省</option>
                                        </select>
                                    </dd>
                                    <dd class="flt pre layui-form dd-city rg_group ml10">
                                        <select name="city" rg-validate-field="city" lay-filter="city" lay-search>
                                            <option value="">请选择市</option>
                                        </select>
                                    </dd>
                                    <dd class="flt ml10"><input style="width: 280px;" placeholder="请输入详细地址" type="text" name="address" autocomplete="off" class="layui-input"></dd>
                                </dl>
                            </div>
                            <div class="mt20" hidden id="chongtouDiv">
                                <hr class="hr-bor" />
                                <span class="iconfont icon-icon13 frt fz12 c-9 mb10 cs-p"></span>
                                <table class="layui-table pop" lay-skin="line">
                                    <colgroup>
                                        <col  width="300">
                                        <col  width="150">
                                        <col  width="150">
                                        <col  width="150">
                                        <col  width="150">
                                        <col  width="150">
                                    </colgroup>
                                    <thead>
                                    <tr>
                                        <th >客户名称</th>
                                        <th >地址</th>
                                        <th >销售代表</th>
                                        <th >客户经理</th>
                                        <th >创建时间</th>
                                        <th >操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </blockquote>
                    </div>
                    <div>
                        <h3 class="bg-f0 h3-tittle pl10 mt20">主要联系人</h3>
                        <blockquote class="layui-elem-quote layui-quote-nm layui-elem-bor" style="padding-left: 40px;">
                            <div>
                            <dl class="dl-form">
                                <dt class="flt fz12"><span class="c-f">*</span>姓名：</dt>
                                <dd class="flt layui-form pre rg_group">
                                    <input type="text" name="linkmanName" rg-validate-field="linkmanName" placeholder="请输入联系人姓名" autocomplete="off" class="layui-input">
                                </dd>
                                <dt class="flt fz12"><span class="c-f">*</span>性别：</dt>
                                <dd class="flt pre layui-form">
                                    <input type="radio" name="sex" value="male" title="先生" checked="">
                                    <input type="radio" name="sex" value="female" title="女士">
                                </dd>
                            </dl>
                            <dl class="dl-form">
                                <dt class="flt fz12"><span class="c-f">*</span>手机号：</dt>
                                <dd class="flt pre rg_group"><input type="text" name="linkmanTelephone" rg-validate-field="linkmanTelephone"  placeholder="请输入联系方式" autocomplete="off" class="layui-input"></dd>
                                <dt class="flt fz12">座机：</dt>
                                <dd class="flt pre rg_group"><input type="text" name="linkmanFixedTelephone" rg-validate-field="linkmanFixedTelephone"  placeholder="格式：027-88888888" autocomplete="off" class="layui-input"></dd>
                            </dl>
                            <dl class="dl-form">
                                <dt class="flt fz12">QQ：</dt>
                                <dd class="flt pre rg_group"><input type="text" name="linkmanQQ" rg-validate-field="linkmanQQ"  placeholder="请输入QQ" autocomplete="off" class="layui-input"></dd>
                                <dt class="flt fz12">邮箱：</dt>
                                <dd class="flt rg_group"><input type="text" name="email" rg-validate-field="email"  placeholder="请输入邮箱" autocomplete="off" class="layui-input"></dd>
                            </dl>
                            <dl class="dl-form">
                                <dt class="flt fz12">职位：</dt>
                                <dd class="flt"><input type="text" name="duty"  placeholder="请输入职位" autocomplete="off" class="layui-input"></dd>
                                <dt class="flt fz12">部门：</dt>
                                <dd class="flt"><input type="text" name="department"  placeholder="请输入部门" autocomplete="off" class="layui-input"></dd>
                            </dl>
                            <dl class="dl-form">
                                <dt class="flt fz12" style="width: 115px;margin-left:-25px;">订货系统账号：</dt>
                                <dd class="flt c-2" style="line-height: 32px;">
                                    <input type="radio" name="createAccount" lay-filter="createAccount" value="Y" title="创建" checked="">
                                    <input type="radio" name="createAccount" lay-filter="createAccount" value="N" title="不创建" >
                                </dd>
                            </dl>
                            <dl class="dl-form" id="createAccount">
                                <dt class="flt fz12"><span class="c-f">*</span>登录名：</dt>
                                <dd class="flt rg_group"><input type="text" name="loginName"  rg-validate-field="loginName" placeholder="请输入登录名" autocomplete="off" class="layui-input"></dd>
                                <dt class="flt fz12"><span class="c-f">*</span>初始密码：</dt>
                                <dd class="flt"><input style="background-color: #dcdcdc;" type="text" name="initialPassword" disabled="" placeholder="123456" autocomplete="off" class="layui-input"></dd>
                            </dl>
                            </div>
                        </blockquote>
                        <h3 class="bg-f0 h3-tittle pl10 mt20">财务信息</h3>
                        <blockquote class="layui-elem-quote layui-quote-nm layui-elem-bor" style="padding-left: 40px;">
                            <div class="mb20">
                                <span class="c-2 fz14 mr10">对公账号</span>
                                <div style="width:90%;display:inline-block;vertical-align: super;border-bottom: 1px solid #dcdcdc;"></div>
                            </div>
                            <dl class="dl-form">
                               <dt class="flt fz12"><span class="c-f">*</span>税号：</dt>
                               <dd class="flt pre rg_group"><input type="text" name="taxNum" rg-validate-field="taxNum"  placeholder="请输入联系方式" autocomplete="off" class="layui-input"></dd>
                               <dt class="flt fz12"><span class="c-f">*</span>注册地址：</dt>
                               <dd class="flt pre rg_group"><input type="text" name="registerAddress" rg-validate-field="registerAddress"  placeholder="请输入联系方式" autocomplete="off" class="layui-input"></dd>
                            </dl>
                            <dl class="dl-form">
                               <dt class="flt fz12"><span class="c-f">*</span>开户银行：</dt>
                               <dd class="flt pre rg_group"><input type="text" name="publicBankName" rg-validate-field="publicBankName"  placeholder="请输入联系方式" autocomplete="off" class="layui-input"></dd>
                               <dt class="flt fz12"><span class="c-f">*</span>银行账号：</dt>
                               <dd class="flt pre rg_group"><input type="text" name="publicBankAccount" rg-validate-field="publicBankAccount"  placeholder="请输入联系方式" autocomplete="off" class="layui-input"></dd>
                            </dl>
                            <div class="mb20">
                                <span class="c-2 fz14 mr10">对私账号</span>
                                <div style="width:90%;display:inline-block;vertical-align: super;border-bottom: 1px solid #dcdcdc;"></div>
                            </div>
                            <dl class="dl-form">
                               <dt class="flt fz12"><span class="c-f">*</span>收款人姓名：</dt>
                               <dd class="flt pre rg_group"><input type="text" name="payeeName" rg-validate-field="payeeName"  placeholder="请输入联系方式" autocomplete="off" class="layui-input"></dd>
                               <dt class="flt fz12"><span class="c-f">*</span>银行账号：</dt>
                               <dd class="flt pre rg_group"><input type="text" name="payeeBankAccount" rg-validate-field="payeeBankAccount"  placeholder="请输入联系方式" autocomplete="off" class="layui-input"></dd>
                            </dl>
                            <dl class="dl-form">
                               <dt class="flt fz12"><span class="c-f">*</span>开户银行：</dt>
                               <dd class="flt pre rg_group"><input type="text" name="payeeBankName" rg-validate-field="payeeBankName"  placeholder="请输入联系方式" autocomplete="off" class="layui-input"></dd>
                            </dl>
                        </blockquote>
                    </div>
                    <div class="pb20 t-c mt20">
                        <button class="form-btn layui-btn-small ml10" lay-submit="" lay-filter="formDemo">提交</button>
                    </div>
                </form>
            </div>
        </div>
    </section>
</section>
<script type="text/javascript">
//省市联动  star
    var areaData = Area; 
    var $form;
    var form;
    var element;
    var $;
    var createOrnot = true;
    var rgValidator;

    layui.use(['form','element'], function() {
        form = layui.form();
        element = layui.element();
        $form = $('form');
        loadProvince();

        form.on('radio(createAccount)', function(data){
            if(data.value=="Y"){
                createOrnot = true;
                $("#createAccount").css('display','block');
            }else{
                createOrnot = false;
                $("#createAccount").css('display','none');
            }
         
        });

        rgValidator = new RgValidator(ops);
        rgValidator.bindValidator();
        //提交按钮
        form.on('submit(formDemo)', function(data) {
            submitAccount(data, 1);
            return false;
        });

    });

    function loadProvince() {
      var proHtml = '';
     for(var i = 0; i < areaData.length; i++) {
        proHtml += '<option value="' + areaData[i].provinceCode + '_' + areaData[i].mallCityList.length + '_' + i + '">' +
            areaData[i].provinceName + '</option>';
     }
    //初始化省数据
       $form.find('select[name=province]').append(proHtml);
       form.render();
       form.on('select(province)', function(data) {
       var value = data.value;
       var d = value.split('_');
       var code = d[0];
       var count = d[1];
       var index = d[2];
       if(count > 0) {
          loadCity(areaData[index].mallCityList);
        } else {
          $form.find('select[name=city]').parent().hide();
        }
      });
    }
 
    function loadCity(citys) {
      var cityHtml = '';
      for(var i = 0; i < citys.length; i++) {
        cityHtml += '<option value="' + citys[i].cityCode + '_' + citys[i].mallAreaList.length + '_' + i + '">' +
        citys[i].cityName + '</option>';
      }
     $form.find('select[name=city]').html(cityHtml).parent().show();
     form.render();
    }
    
    //校验字段
    var ops = {
        form: "distributor_basic_frm",
        valid: "",
        invalidMessageClass : ' iconfont c-f jun-ch fz12 ',
        invalidMessageStyle : '',
        invalidIconOnlyWhileRequired : true,
        fieldInType: "dd",
        fields:{
            companyName : {
                message : '公司名称验证失败',
                callback : 'enableSubmitBtn',
                validators : {
                    notEmpty : {
                        message : "请填写公司名称！"
                    },
                    csValidating : {
                        callback : 'companyNameCsValidator',
                        message : '与分销商库中分销商存在冲突<span class="c-h ml10 cs-p repeat-view-msg" style="line-height: 32px;" onclick="queryCheckConflictCompanyName()">查看冲突</span>'
                    }
                }
            },
            inteSocialCreditNo : {
                message : '公司名称验证失败',
                callback : "enableSubmitBtn",
                validators : {
                    notEmpty : {
                        message : "请填写统一社会信用代码！"
                    },
                    regexp : {
                        message : "统一社会信用代码格式不正确",
                        regexp : /(^[0-9A-Z]{18}$)|(^[0-9A-Z]{15}$)|(^无$)/
                    },
                    service : {
                        ifregexp : /(^[0-9A-Z]{18}$)|(^[0-9A-Z]{15}$)/,
                        url : '/systemAccount/checkConflictInteSocialCreditNo',
                        message : '与分销商库中分销商存在冲突<span class="c-h ml10 cs-p repeat-view-msg" style="line-height: 32px;" onclick="queryCheckConflictInteSocialCreditNo()">查看冲突</span>'
                    },
                    csValidating: {
                        callback : 'repeatCheck',
                        message : ""
                    }
                }
            },
            telephone: {
                message : '公司座机验证失败',
                validators : {
                    regexp : {
                        message : "输入的电话格式不正确(由数字或-组成)",
                        regexp : /^0[\d]{2,3}-[\d]{7,8}$/
                    }
                }
            },
            district : {
                message : '所选区域验证失败',
                validators : {
                    notEmpty : {
                        message : "请填写区域！"
                    }
                }
            },
            accountManager : {
                message : '所选客户经理验证失败',
                validators : {
                    notEmpty : {
                        message : "请选择客户经理！"
                    }
                }
            },
            sales : {
                message : '所选销售代表验证失败',
                validators : {
                    notEmpty : {
                        message : "请选择销售代表！"
                    }
                }
            },
            province : {
                message : '所选省份验证失败',
                validators : {
                    notEmpty : {
                        message : "请填写省份！"
                    }
                }
            },
            city : {
                message : '所选城市验证失败',
                validators : {
                    notEmpty : {
                        message : "请填写城市！"
                    }
                }
            },
            linkmanName : {
                message : '联系人验证失败',
                validators : {
                    notEmpty : {
                        message : "请填写联系人！"
                    }
                }
            },
            linkmanTelephone: {
                message : '手机号验证失败',
                validators : {  
                    notEmpty : {
                        message : "请填写手机号！"
                    },
                    regexp : {
                        message : "输入的手机号码格式不正确！",
                        regexp : /^1[34578]\d{9}$/
                    }                 
                }
            },
            linkmanFixedTelephone: {
                message : '联系人座机验证失败',
                validators : {
                    regexp : {
                        message : "输入的座机格式不正确(由数字或-组成)",
                        regexp : /^0[\d]{2,3}-[\d]{7,8}$/
                    }
                }
            },
            linkmanQQ:{
                message : 'QQ号码验证失败',
                validators : {
                    regexp : {
                        message : "您输入的QQ格式不正确哦！",
                        regexp : /^[1-9][0-9]{4,9}$/
                    }
                }
            },
            email: {
                message : '邮箱验证失败',
                validators : {
                    regexp : {
                        message : "您输入的邮箱格式不正确哦！",
                        regexp : /^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/
                    }
                }
            },
            loginName: {
                message : '登录名验证失败',
                validators : {
                    notEmpty : {
                        message : "请填写登录名！"
                    },
                    csValidating : {
                        callback : 'loginNameCsValidator',
                        message : '该用户名已存在！'
                    }
                }
            },
            taxNum: {
                message : '税号验证失败',
                validators : {
                    notEmpty : {
                        message : "请填写税号！"
                    },
                    regexp : {
                        message : "您输入的税号格式不正确哦！",
                        regexp : /^\d{15,}$/
                    }
                }
            },
            registerAddress: {
                message : '注册地址验证失败',
                validators : {
                    notEmpty : {
                        message : "请填写注册地址！"
                    },
                }
            },
            publicBankName:{
                message : '对公开户银行验证失败',
                validators : {
                    notEmpty : {
                        message : "请填写对公开户银行！"
                    },
                    regexp : {
                        message : "您输入的开户银行格式不正确哦！",
                        regexp : /^[\u2E80-\u9FFF]+$/
                    }
                }
            },
            publicBankAccount:{
                message : '对公开户银行账号验证失败',
                validators : {
                    notEmpty : {
                        message : "请填写对公银行账号！"
                    },
                    regexp : {
                        message : "您输入的银行账号格式不正确哦！",
                        regexp : /^\d{19}$/
                    }
                }
            },
            payeeName:{
                message : '收款人姓名验证失败',
                validators : {
                    notEmpty : {
                        message : "请填写收款人姓名！"
                    }
                }
            },
            payeeBankName:{
                message : '对私开户银行验证失败',
                validators : {
                    notEmpty : {
                        message : "请填写对私开户银行！"
                    },
                    regexp : {
                        message : "您输入的开户银行格式不正确哦！",
                        regexp : /^[\u4e00-\u9fa5],{0,}$ /
                    }
                }
            },
            payeeBankAccount:{
             message : '对私开户银行账号验证失败',
             validators : {
                notEmpty : {
                    message : "请填写对私银行账号！"
                },
                regexp : {
                    message : "您输入的银行账号格式不正确哦！",
                    regexp : /^\d{19}$/
                }
             }
            }
         
        }
    };

    //公司名是否重复校验
    function companyNameCsValidator(obj){
        var blresult = true;
      
        return blresult;
    }

    //用户名是否重复校验
    function loginNameCsValidator(obj){
        var blresult = true;
       
        return blresult;
    }

    function submitAccount(data, type){
        rgValidator.validateOnSubmit(ops);
        if(rgValidator.validateOnSubmit(ops) != ''){
            layer.msg("页面填写有误或者有冲突，请检查", {icon: 5});
            return false;
        }
        // callSubmitAccount(data, type);
    }

    function callSubmitAccount(data, type){
        var param = {};
        param.data = JSON.stringify(data.field);
        //alert(JSON.stringify(data.field));
        layer.load();
        postUtil.call('/systemAccount/detail', param, function(result) {
            //alert(JSON.stringify(result));
            layer.open({
                title: '操作提示',
                skin: 'youskin',
                area: ['480px', '300px'],
                btnAlign: 'c',
                content: '<p class="iconfont icon-yiwancheng1" style="text-align: center;margin-top: 30px;"></p><p style="text-align: center;margin-top: 30px;font-size:12px;color:#222222">' + result.MSG + '</p>',
                btn: ['关闭'],
                yes: function(index, layero){
                    //TODO 跳转至详情页面
                    if(type == 1){
                        postUtil.submit('/mallCustomer/preDetail?accountId=' + result.DATA,null);
                    }else{
                        postUtil.submit('/systemAccount/preModify',null);
                    }
                    layer.closeAll('loading');
                }
            });
        });
    }



</script>

</body>
</html>
