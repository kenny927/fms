<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="/res/css/style.css<@resVersionDirective>?</@>"/>
    <link rel="stylesheet" type="text/css" href="http://at.alicdn.com/t/font_p3j907q2agbq33di.css<@resVersionDirective>?</@>"/>
    <script src="/res/js/jquery-3.1.1.min.js<@resVersionDirective>?</@>"></script>
    <script src="/res/public/layer/layer.js<@resVersionDirective>?</@>"></script>
    <script type="text/javascript" src="/res/common/post.js<@resVersionDirective>?</@>"></script>
    <script type="text/javascript" src="/res/common/globalVar.js<@resVersionDirective>?</@>"></script>
    <script type="text/javascript" src="/res/common/numCheck.js<@resVersionDirective>?</@>"></script>
</head>
<body>
<section id="itocCenter">
    <section class="itocContent">
        <nav class="usermsg">
            <ul>
                <li>
                    <p class="fz16 t-c">工程商</p>
                    <p class="fz12">账号：
                        <#if buyerUserInfo??>${buyerUserInfo.mobile!"--"}</#if>
                    </p>
                    <p class="fz12">用户名：
                        <#if buyerUserInfo??>${buyerUserInfo.userRealName!"--"}</#if>
                    </p>
                    <p class="fz12">公司名称：
                        <#if buyerUserInfo??>${buyerUserInfo.accountName!"--"}</#if>
                    </p>
                </li>
                <li>
                    <p class="fz16 t-c">分销商</p>
                    <p class="fz12">公司名称：--</p>
                    <p class="fz12">联系人：--</p>
                    <p class="fz12">手机号：--</p>
                </li>
                <li>
                    <p class="fz16 t-c">专属客户经理：
                        <#if accountManagerInfo??>${accountManagerInfo.userRealName!"--"}</#if>
                    </p>
                    <p class="fz12">手机：
                        <#if accountManagerInfo??>${accountManagerInfo.mobile!"--"}</#if>
                    </p>
                    <p class="fz12">QQ：
                        <#if accountManagerInfo??>${accountManagerInfo.qq!"--"}</#if>
                    </p>
                    <p class="fz12">邮箱：
                        <#if accountManagerInfo??>${accountManagerInfo.email!"--"}</#if>
                    </p>
                </li>
            </ul>
        </nav>
        <div class="itocMain">
            <input type="hidden" id="vagueDemandId" value="${mallVagueDemand.demandId}">
            <input type="hidden" id="vagueDemandBuyerUserId" value="${buyerUserInfo.userId}">
            <input type="hidden" id="vagueDemandBuyerAccountId" value="${buyerUserInfo.accountId}">
            <input type="hidden" id="vagueDemandBuyerAccountName" value="${buyerUserInfo.accountName}">
            <input type="hidden" id="vagueDemandBuyerAccountManagerId" <#if accountManagerInfo??>value="${accountManagerInfo.userId}"<#else>value=""</#if> >
            <input type="hidden" id="vagueDemandBuyerAccountManagerName" <#if accountManagerInfo??>value="${accountManagerInfo.userRealName}"<#else>value=""</#if> >
            <div class="usermsg1">
                <div class="roleDetail">
                    <p>委托单<span>${mallVagueDemand.demandId}</span><a href="javascript:;">展开>></a></p>
                </div>
                <div class="detailContent">
                    <dl class="detail-list">
                        <dt>委托状态：</dt>
                        <dd>${mallVagueDemand.statusName}</dd>
                        <input type="hidden" value="${mallVagueDemand.status}" id="mallVagueDemandStatus" />
                    </dl>
                    <dl class="detail-list">
                        <dt>跟进人：</dt>
                        <dd><#if accountManagerInfo??>${accountManagerInfo.userRealName!"--"}</#if>&nbsp; <#if accountManagerInfo??>${accountManagerInfo.mobile!"--"}</#if></dd>
                    </dl>
                    <dl class="detail-list">
                        <dt>项目地：</dt>
                        <dd>${mallVagueDemand.projectProvince}/${mallVagueDemand.projectCity}</dd>
                    </dl>
                    <dl class="detail-list">
                        <dt>期望交期：</dt>
                        <dd><span class="fw-b fz14 c-f">${mallVagueDemand.expectDeliveryTimeStr}</span></dd>
                    </dl>
                    <dl class="detail-list">
                        <dt>预留姓名：</dt>
                        <dd><span class="roleColor">${mallVagueDemand.contactsName}</span></dd>
                    </dl>
                    <dl class="detail-list">
                        <dt>预留联系电话：</dt>
                        <dd><span class="roleColor">${mallVagueDemand.contactsMobileOrFixedPhoneNumber}</span></dd>
                    </dl>
                    <dl class="detail-list read-only">
                        <dt>需求描述：</dt>
                        <dd class="">${mallVagueDemand.demandDescribe}</dd>
                    </dl>
                    <dl class="detail-list layuicss">
                        <dt>需求附件：</dt>
                        <dd class="need-list">
                            <ul>
                                <#assign attachmentList = mallVagueDemand.attachments>
                                    <#if (attachmentList?size>0) >
                                        <#list attachmentList as attachment>
                                            <li class="c-h">
                                                <a href="javascript:void(0)" title="${attachment.attachmentName}" style="width: 100px;display: block;white-space:nowrap;" class="one-row" onclick="downLoadAttachment('${attachment.attachmentId}')">${attachment.attachmentName}</a>
                                            </li>
                                        </#list>
                                        <#else>
                                            <li class="c-h">
                                                <a href="javascript:void(0)">--</a>
                                            </li>
                                    </#if>
                            </ul>
                        </dd>
                    </dl>
                </div>



                <div id="mallBuyerEunquireDiv">
                <div class="roleDetail">
                    <p>询价单<span></span><a href="javascript:;">展开>></a></p>
                </div>
                <div>
                    <div class="table inquiry">
                        <a href="javascript:void(0);" id="addSkuBtn" class="frt fz12 choice">+添加SKU商品</a>
                        <ul class="th compact">
                            <li style="width: 6%;">
                                <div class="mida">
                                    <div class="midb">商品编码</div>
                                </div>
                            </li>
                            <li style="width: 7%;">
                                <div class="mida">
                                    <div class="midb">品牌</div>
                                </div>
                            </li>
                            <li style="width: 26%;">
                                <div class="mida">
                                    <div class="midb">商品名称</div>
                                </div>
                            </li>
                            <li style="width: 15%;">
                                <div class="mida">
                                    <div class="midb">商品型号</div>
                                </div>
                            </li>
                            <li style="width: 27%;">
                                <div class="mida">
                                    <div class="midb">描述</div>
                                </div>
                            </li>
                            <li style="width: 7%;">
                                <div class="mida">
                                    <div class="midb"><span style="color: red;">*</span>数量</div>
                                </div>
                            </li>
                            <li style="width: 7%;">
                                <div class="mida">
                                    <div class="midb">计量单位</div>
                                </div>
                            </li>
                            <li style="width: 5%;border-right:none;">
                                <div class="mida">
                                    <div class="midb">操作</div>
                                </div>
                            </li>
                        </ul>
                        <div class="information-list" id="skuTable">

                        </div>
                    </div>
                    <div class="table inquiry">
                        <a href="javascript:void(0);" id="addCustomSkuBtn" class="frt fz12 choice">+添加自定义商品</a>
                        <ul class="th compact">
                            <li style="width: 10%;">
                                <div class="mida">
                                    <div class="midb"><span style="color: red;">*</span>品牌</div>
                                </div>
                            </li>
                            <li style="width: 23%;">
                                <div class="mida">
                                    <div class="midb"><span style="color: red;">*</span>商品名称</div>
                                </div>
                            </li>
                            <li style="width: 21%;">
                                <div class="mida">
                                    <div class="midb">商品型号</div>
                                </div>
                            </li>
                            <li style="width: 27%;">
                                <div class="mida">
                                    <div class="midb">描述</div>
                                </div>
                            </li>
                            <li style="width: 7%;">
                                <div class="mida">
                                    <div class="midb"><span style="color: red;">*</span>数量</div>
                                </div>
                            </li>
                            <li style="width: 7%;">
                                <div class="mida">
                                    <div class="midb"><span style="color: red;">*</span>计量单位</div>
                                </div>
                            </li>
                            <li style="width: 5%;">
                                <div class="mida">
                                    <div class="midb">操作</div>
                                </div>
                            </li>
                        </ul>
                        <div class="information-list" id="customSkuTable">

                        </div>
                    </div>
                    <div class="detailContent Inquirytitle">
                        <dl class="detail-list">
                            <dt>期望交期：</dt>
                            <dd><span class="fw-b fz14 c-f">${mallVagueDemand.expectDeliveryTimeStr}</span></dd>                           
                            <input id="enquire_expectDeliveryTime" value="${mallVagueDemand.expectDeliveryTimeStr}" type="hidden">
                        </dl>
                        <dl class="detail-list">
                            <dt>报价方式：</dt>
                            <dd>委托平台报价</dd>
                            <input id="enquire_offerMode" value="PLATFORM" type="hidden">
                        </dl>

                        <dl class="detail-list status-radio">
                            <dt><span class="c-f">*</span>配送方式：</dt>
                            <dd><label><input type="radio" name="enquire_deliveryMode" value="LORRY" checked="checked"/><span>汽车</span></label></dd>
                            <dd><label><input type="radio" name="enquire_deliveryMode" value="RAILWAY"/>铁路</label></dd>
                            <dd><label><input type="radio" name="enquire_deliveryMode" value="AIRLIFT"/>空运</label></dd>
                            <dd><label><input type="radio" name="enquire_deliveryMode" value="EXPRESS"/>快递</label></dd>
                            <dd><label><input type="radio" name="enquire_deliveryMode" value="SELF_PICK"/>客户自提</label></dd>
                            <dd><label><input type="radio" name="enquire_deliveryMode" value="OTHER"/>其他</label></dd>
                            <dd><label><input id="enquire_deliveryModeRemark" style="border:1px solid #E6E6E6;height: 35px;margin-top: -15px;width: 230px;" type="text" class="fz12 pl10" placeholder="请输入其他配送方式"/></label></dd>
                        </dl>
                        <dl class="detail-list">
                            <dt>项目地：</dt>
                            <dd>${mallVagueDemand.projectProvince}/${mallVagueDemand.projectCity}</dd>
                            <input id="enquire_projectProvince" value="${mallVagueDemand.projectProvince}" type="hidden">
                            <input id="enquire_projectCity" value="${mallVagueDemand.projectCity}" type="hidden">
                        </dl>


                        <dl class="detail-list status-radio">
                            <dt><span class="c-f">*</span>结算方式：</dt>
                            <dd><label><input type="radio" name="enquire_payMode" value="CASH_BEFORE_DELIVERY" checked="checked"/><span>先款后货</span></label></dd>
                            <dd>
                                <input type="radio" name="enquire_payMode" value="DEPOSIT"/>订金支付
                            </dd>
                            <dd> 
                                <input class="fz12 t-c" id="deposit_remark" style="width: 32px;margin-top: -10px;height: 25px;border: 1px solid #E6E6E6;" type="text"/>
                            </dd>
                            <dd>%</dd>
                            <!--<dd><label>-->
                                <!--<input type="radio" name="enquire_payMode" value="CASH_ON_DELIVERY"/><span>账期支付(货到</span>-->
                                <!--<p class="per" style="right: -35px;width: 30px;">-->
                                    <!--<input class="fz12 t-c" id="cash_on_delivery_remark" style="width: 70px;height: 25px; padding-left: 5px;border: 1px solid #E6E6E6;" type="text" placeholder="天数"/></p><span style="margin-left: 90px;">付款)</span></label></dd>-->
                            <dd><label><input type="radio" name="enquire_payMode" value="CASH_ON_DELIVERY"/><span>账期支付(货到</span></dd></label>
                            <dd><input class="fz12 t-c" id="cash_on_delivery_remark" style="width: 70px;height: 25px; padding-left: 5px;border: 1px solid #E6E6E6; margin-top: -10px;" type="text" placeholder="输入天数" /></dd>
                            <dd>天付款)</dd>
                        </dl>
                        <dl class="detail-list status-radio">
                            <dt>开票信息：</dt>
                            <dd><label><input type="radio" checked="checked" value="Y" name="enquire_isNeedInvoice"/>开票(增值税专用发票)</label>
                            </dd>
                            <dd><label><input type="radio" name="enquire_isNeedInvoice" value="N"/>不开票</label></dd>
                        </dl>
                        <dl class="detail-list read-only">
                            <dt>备注：</dt>
                            <dd>
                                <textarea id="enquire_remark" style="padding: 10px; border: 1px solid #E6E6E6;" rows="5" cols="111" placeholder="请输入您对该商品的其他需求(200字以内)"></textarea>
                            </dd>
                        </dl>
                    </div>
                    <div class="sure-btn mb20" style="margin-top: -10px;">
                        <span class="sure" id="genMallEnquireBtn">生成询价单</span>
                    </div>
                </div>
            </div>
                <div class="sure-btn mb20" style="margin-top: -10px;">
                    <span class="sure" id="returnMallVagueDemandListBtn" style="display: none;">返回</span>
                </div>
            </div>
        </div>
    </section>
</section>
<script type="text/javascript">

    $(function () {
        //初始化状态为展开状态
        $(".roleDetail a").each(function () {
            $(this).parent().parent().next().show();
            $(this).html("收起>>");
        });

        //添加商品按钮绑定事件
        $('#addSkuBtn').bind("click", function () {
            layer.open({
                title: "请选择SKU",
                type: 2,
                area: ['1000px', '650px'],
                fixed: false, //不固定
                maxmin: true,
                content: '/reusable/skuCommodity/chooseSkuCommodityForMallClassifyPage'
            });
        });

        //返回按钮绑定事件
        $('#returnMallVagueDemandListBtn').bind("click",function(){
            postUtil.submit("/mallOrder/vagueDemand/preListVagueDemand")
        });

        //生成询单按钮绑定事件
        $('#genMallEnquireBtn').bind("click", function () {

            if (skuCommodityDataList.length == 0 && customerSkuCommodityDataList.length == 0) {
                layer.msg('请选择商品后再生成询单！', {icon: 5});
                return;
            }

            if (skuCommodityDataList.length > 0) {
                for (var i = 0; i < skuCommodityDataList.length; i++) {
                    var tempSkuCommodity = skuCommodityDataList[i];
                    var tempSkuId = tempSkuCommodity.skuId;
                    var skuDescribe = $('#skuDescirbes_' + tempSkuId).val();
                    var skuQuantity = $('#skuQuantity_' + tempSkuId).val();
//                    if (null == skuDescribe || "" == skuDescribe) {
//                        layer.msg('sku商品描述不允许为空', {icon: 5});
//                        return;
//                    }
                    if (null == skuQuantity || "" == skuQuantity) {
                        layer.msg('sku商品数量不允许为空', {icon: 5});
                        return;
                    }else{
                        if(isNaN(skuQuantity)) {
                            layer.msg('sku商品数量必须为数字', {icon: 5});
                            return;
                        }else if (skuQuantity <= 0) {
                            layer.msg('sku商品数量必须大于0', {icon: 5});
                            return;
                        }else {
//                            var dot = skuQuantity.indexOf(".");
//                            if(dot != -1){
//                                var dotCnt = skuQuantity.substring(dot+1,skuQuantity.length);
//                                if(dotCnt.length > 2){
//                                    layer.msg('自定义商品数量小数点后只允许两位', {icon: 5});
//                                    return;
//                                }
//                            }
                        }
                    }
                    tempSkuCommodity.skuDescribe = skuDescribe;
                    tempSkuCommodity.skuQuantity = skuQuantity;
                }
            }

            if (customerSkuCommodityDataList.length > 0) {
                for (var i = 0; i < customerSkuCommodityDataList.length; i++) {
                    var tempCustomerSku = customerSkuCommodityDataList[i];
                    var tempCustomerSkuId = tempCustomerSku.customerSkuId;
                    var tempCustomerSkuModel = $("#customerSkuModel_" + tempCustomerSkuId).val();
                    var tempCustomerSkuBrandName = $("#customerSkuBrandName_" + tempCustomerSkuId).val();
                    var tempCustomerSkuName = $("#customerSkuName_" + tempCustomerSkuId).val();
                    var tempCustomerSkuDescribe = $("#customerSkuDescribe_" + tempCustomerSkuId).val();
                    var tempCustomerSkuQuantity = $("#customerSkuQuantity_" + tempCustomerSkuId).val();
                    var tempCustomerSkuUnitName = $("#customerSkuUnitName_" + tempCustomerSkuId).val();
//                    if (null == tempCustomerSkuModel || "" == tempCustomerSkuModel) {
//                        layer.msg('自定义商品型号不允许为空', {icon: 5});
//                        return;
//                    }
                    if (null == tempCustomerSkuBrandName || "" == tempCustomerSkuBrandName) {
                        layer.msg('自定义商品品牌不允许为空', {icon: 5});
                        return;
                    }
                    if (null == tempCustomerSkuName || "" == tempCustomerSkuName) {
                        layer.msg('自定义商品名称不允许为空', {icon: 5});
                        return;
                    }
//                    if (null == tempCustomerSkuDescribe || "" == tempCustomerSkuDescribe) {
//                        layer.msg('自定义商品描述不允许为空', {icon: 5});
//                        return;
//                    }
                    if (null == tempCustomerSkuQuantity || "" == tempCustomerSkuQuantity) {
                        layer.msg('自定义商品数量不允许为空', {icon: 5});
                        return;
                    }else {
                        if (null == tempCustomerSkuQuantity || "" == tempCustomerSkuQuantity) {
                            layer.msg('自定义商品数量不允许为空', {icon: 5});
                            return;
                        }else{
                            if(isNaN(tempCustomerSkuQuantity)) {
                                layer.msg('自定义商品数量必须为数字', {icon: 5});
                                return;
                            }else if (tempCustomerSkuQuantity <= 0) {
                                layer.msg('自定义商品数量必须大于0', {icon: 5});
                                return;
                            }else {
                                var dot = tempCustomerSkuQuantity.indexOf(".");
                                if(dot != -1){
                                    var dotCnt = tempCustomerSkuQuantity.substring(dot+1,tempCustomerSkuQuantity.length);
                                    if(dotCnt.length > 3){
                                        layer.msg('自定义商品数量小数点后只允许三位', {icon: 5});
                                        return;
                                    }
                                }
                            }
                        }
                    }
                    if (null == tempCustomerSkuUnitName || "" == tempCustomerSkuUnitName) {
                        layer.msg('自定义商品单位不允许为空', {icon: 5});
                        return;
                    }
                    tempCustomerSku.customerSkuModel = tempCustomerSkuModel;
                    tempCustomerSku.customerSkuBrandName = tempCustomerSkuBrandName;
                    tempCustomerSku.customerSkuName = tempCustomerSkuName;
                    tempCustomerSku.customerSkuDescribe = tempCustomerSkuDescribe;
                    tempCustomerSku.customerSkuQuantity = tempCustomerSkuQuantity;
                    tempCustomerSku.customerSkuUnitName = tempCustomerSkuUnitName;
                }
            }

            //生成询单的关键信息
            var expectDeliveryTime = $('#enquire_expectDeliveryTime').val();
            var offerMode = $('#enquire_offerMode').val();
            var deliveryMode = $("input[name='enquire_deliveryMode']:checked").val();
            var deliveryModeRemark = $('#enquire_deliveryModeRemark').val();
            if ("OTHER" == deliveryMode) {
                if (null == deliveryModeRemark || "" == deliveryModeRemark) {
                    layer.msg('请填写其他配送方式的详细信息', {icon: 5});
                    return;
                }
            }
            var projectProvince = $('#enquire_projectProvince').val();
            var projectCity = $('#enquire_projectCity').val();

            var payMode = $("input[name='enquire_payMode']:checked").val();
            var payModeRemark = "";
            var deposit_remark = $("#deposit_remark").val();
            var cash_on_delivery_remark = $("#cash_on_delivery_remark").val();
            if ("DEPOSIT" == payMode) {
                if (null == deposit_remark || "" == deposit_remark) {
                    layer.msg('请填写订金的详细信息', {icon: 5});
                    return;
                }
                if(isNaN(deposit_remark)) {
                    layer.msg('您输入的订金不合法', {icon: 5});
                    return;
                }else if(deposit_remark <= 0 || deposit_remark > 100){
                    layer.msg('您输入的订金不合法', {icon: 5});
                    return;
                }else {
                    var dot = deposit_remark.indexOf(".");
                    if(dot != -1){
                        var dotCnt = deposit_remark.substring(dot+1,deposit_remark.length);
                        if(dotCnt.length > 2){
                            layer.msg('订金比例小数点后只允许两位', {icon: 5});
                            return;
                        }
                    }
                }
                payModeRemark = deposit_remark;
            }
            if ("CASH_ON_DELIVERY" == payMode) {
                if (null == cash_on_delivery_remark || "" == cash_on_delivery_remark) {
                    layer.msg('请填写账期信息', {icon: 5});
                    return;
                }
                if(isNaN(cash_on_delivery_remark)) {
                    layer.msg('您输入的账期不合法', {icon: 5});
                    return;
                }else if(cash_on_delivery_remark < 0 ){
                    layer.msg('您输入的账期不合法', {icon: 5});
                    return;
                }
                payModeRemark = cash_on_delivery_remark;
            }
            var isNeedInvoice = $("input[name='enquire_isNeedInvoice']:checked").val();
            var remark = $('#enquire_remark').val();

            var genBuyerEnquireInfo = {};
            genBuyerEnquireInfo.expectDeliveryTime = expectDeliveryTime;
            genBuyerEnquireInfo.offerMode = offerMode;
            genBuyerEnquireInfo.deliveryMode = deliveryMode;
            genBuyerEnquireInfo.deliveryModeRemark = deliveryModeRemark;
            genBuyerEnquireInfo.projectProvince = projectProvince;
            genBuyerEnquireInfo.projectCity = projectCity;
            genBuyerEnquireInfo.payMode = payMode;
            genBuyerEnquireInfo.payModeRemark = payModeRemark;
            genBuyerEnquireInfo.isNeedInvoice = isNeedInvoice;
            genBuyerEnquireInfo.remark = remark;
            genBuyerEnquireInfo.skuDataList = skuCommodityDataList;
            genBuyerEnquireInfo.customerSkuDataList = customerSkuCommodityDataList;
            genBuyerEnquireInfo.vagueDemandId = $('#vagueDemandId').val();
            genBuyerEnquireInfo.buyerUserId = $('#vagueDemandBuyerUserId').val();
            genBuyerEnquireInfo.buyerAccountId = $('#vagueDemandBuyerAccountId').val();
            genBuyerEnquireInfo.buyerAccountName = $('#vagueDemandBuyerAccountName').val();
            genBuyerEnquireInfo.buyerAccountManagerId = $('#vagueDemandBuyerAccountManagerId').val();
            genBuyerEnquireInfo.buyerAccountManagerName = $('#vagueDemandBuyerAccountManagerName').val();

            var genParam = {};
            genParam.jsonData = JSON.stringify(genBuyerEnquireInfo);
            postUtil.call("/mallOrder/buyerEnquireService/genBuyerEnquireInfo", genParam, function (result) {
                if (result.STATUS == "SUCCESS") {
                    layer.open({
                        title: '操作提示',
                        skin: 'youskin',
                        area: ['480px', '300px'],
                        btnAlign: 'c',
                        content: '<p class="iconfont icon-yiwancheng1" style="text-align: center;margin-top: 30px;"></p><p style="text-align: center;margin-top: 30px;font-size:16px;color:#222222">生成询价单成功！</p>'
                    });
                    setTimeout("postUtil.submit('/mallOrder/vagueDemand/preListVagueDemand')", 3000);
                } else if (result.STATUS == "FAIL") {
                    layer.msg(result.MSG, {icon: 5});
                }
            });

        });

        //添加自定义商品按钮
        $('#addCustomSkuBtn').bind("click", function () {
            renderCustomerSkuRow();
        });


        //根据状态判断当前页面的元素以及展示
        var mallVagueDemandStatus = $('#mallVagueDemandStatus').val();
        if(mallVagueDemandStatus == "CLOSED") {
            $('#mallBuyerEunquireDiv').hide();
            $('#returnMallVagueDemandListBtn').show();
            $('#genMallEnquireBtn').hide();
        }else if(mallVagueDemandStatus == "COMPLETED") {
            $('#addCustomSkuBtn').hide();
            $('#addSkuBtn').hide();
            $('#returnMallVagueDemandListBtn').show();
            $('#genMallEnquireBtn').hide();

            //初始化由该委托单生成询价单的详细信息
            var demandId = $('#vagueDemandId').val();
            var initEnquireInfoParam = {};
            initEnquireInfoParam.demandId = demandId;
            postUtil.call("/mallOrder/buyerEnquireService/getBuyerEnquireByDemandId",initEnquireInfoParam,function(result){
                if(result.STATUS == "SUCCESS") {
                    console.log(JSON.stringify(result));
                    //渲染询价单详情
                    var enquireId = result.data.enquireId;
                    var offerMode = result.data.offerMode;
                    var deliveryMode = result.data.deliveryMode;
                    var deliveryModeRemark = result.data.deliveryModeRemark;
                    var payMode = result.data.payMode;
                    var payModeRemark = result.data.payModeRemark;
                    var isNeedInvoice = result.data.isNeedInvoice;
                    var remark = result.data.remark;

                    $("input[name='enquire_deliveryMode'][value="+deliveryMode+"]").attr("checked",true);
                    if(deliveryMode == "OTHER") {
                        $('#enquire_deliveryModeRemark').val(deliveryModeRemark);
                    }
                    $('#enquire_deliveryModeRemark').attr("disabled","disabled");
                    $("input[name='enquire_deliveryMode']").each(function(){
                        $(this).attr("disabled","disabled");
                    });

                    $("input[name='enquire_payMode'][value="+payMode+"]").attr("checked",true);
                    $('#deposit_remark').attr("disabled","disabled");
                    $('#cash_on_delivery_remark').attr("disabled","disabled");
                    if(payMode == "DEPOSIT") {
                        $('#deposit_remark').val(payModeRemark);

                    }else if(payMode == "CASH_ON_DELIVERY") {
                        $('#cash_on_delivery_remark').val(payModeRemark);
                    }
                    $("input[name='enquire_payMode']").each(function(){
                        $(this).attr("disabled","disabled");
                    });

                    $("input[name='enquire_isNeedInvoice'][value="+isNeedInvoice+"]").attr("checked",true);
                    $("input[name='enquire_isNeedInvoice']").each(function(){
                        $(this).attr("disabled","disabled");
                    });
                    $('#enquire_remark').val(remark);
                    $('#enquire_remark').attr("disabled","disabled");

                    //渲染商品
                    var skuList = result.data.details;
                    if( null != skuList && skuList.length > 0) {
                        renderBuyerEnquireSkuTable(skuList);
                    }

                    //渲染自定义商品
                    var customerSkuList = result.data.customDetails;
                    if( null != customerSkuList && customerSkuList.length > 0) {
                        renderBuyerEnquireCustomerSkuTable(customerSkuList);
                    }

                }else {
                    layer.msg(result.MSG, {icon: 5});
                }
            });

        }

    });

    //结算方式点击事件
    $(document).on("click","input:radio[name='enquire_payMode']",function(){
        var value = $(this).val();
        if(value=="DEPOSIT" && $.trim($("#deposit_remark").val()) == "") {
            $("#deposit_remark").val(30);
        }
        if(value!="DEPOSIT") {
            $("#deposit_remark").val('');
        }
        if(value!="CASH_ON_DELIVERY") {
            $("#cash_on_delivery_remark").val('');
        }
    });

    //配送方式点击
    $(document).on("click","input:radio[name='enquire_deliveryMode']",function(){
        var value = $(this).val();
        if(value!="OTHER") {
            $("#enquire_deliveryModeRemark").val('');
        }
    });

    //绑定伸缩的事件
    $(document).on("click", ".roleDetail a", function () {
        if ($(this).parent().parent().next().css("display") == "none") {
            $(this).parent().parent().next().show();
            $(this).html("收起>>");
        } else {
            $(this).parent().parent().next().hide();
            $(this).html("展开>>");
        }
    });

    //下载附件
    function downLoadAttachment(attachmentId) {
        var downLoadParam = {};
        downLoadParam.fileAttachmentId = attachmentId;
        postUtil.submit("/file_server/mall/generalFileDownload", downLoadParam);
    }

    //sku商品数据集合
    var skuCommodityDataList = [];


    //已生成询单状态查看详情时渲染sku商品信息
    function renderBuyerEnquireSkuTable(skuList) {
        var length = skuList.length;
        var table = document.getElementById("skuTable");
        if (length > 0) {
            for (var i = 0; i < skuList.length; i++) {
                var data = skuList[i];
                var row = renderBuyerEnquireSkuRow(data);
                table.appendChild(row);
            }
            //渲染单位配置控制小数位数
            renderUnitDisplay();
        }
    }

    function renderBuyerEnquireSkuRow(rowData) {
        var skuId = rowData.skuId;
        var skuMode = rowData.skuMode;
        var skuBrandName = rowData.skuBrandName;
        var skuName = rowData.skuName;
        var skuRemark = rowData.remark;
        var skuQuantity = rowData.skuQuantity;
        var skuUnitName = rowData.skuUnitName;
        var ul = document.createElement('ul');

        ul.setAttribute("class", "information informationList compact");
        ul.setAttribute("id", "ul_sku_row_" + skuId);
        ul.appendChild(renderSkuCell("skuId", skuId, "width:6%;"));
        ul.appendChild(renderSkuCell(null, skuBrandName, "width:7%;"));
        ul.appendChild(renderSkuCell(null, skuName, "width:26%;"));
        ul.appendChild(renderSkuCell(null, skuMode, "width:15%;"));
        ul.appendChild(renderSkuCell(null, skuRemark, "width:27%;"));
        ul.appendChild(renderSkuCell(null, skuQuantity, "width:7%;"));
        ul.appendChild(renderSkuCell(null, skuUnitName, "width:7%;"));
        ul.appendChild(renderSkuCell(null, "无", "width:5%;border-right:none;"));
        return ul;
    }

    //已生成询单状态查看详情时渲染自定义sku商品信息
    function renderBuyerEnquireCustomerSkuTable(customerSkuList){
        var length = customerSkuList.length;
        var table = document.getElementById("customSkuTable");
        if (length > 0) {
            for (var i = 0; i < customerSkuList.length; i++) {
                var data = customerSkuList[i];
                var row = renderBuyerEnquireCustomerSkuRow(data);
                table.appendChild(row);
            }
        }
    }

    function renderBuyerEnquireCustomerSkuRow(customerSku) {
        var skuId = customerSku.skuId;
        var skuMode = customerSku.skuMode;
        var skuBrandName = customerSku.skuBrandName;
        var skuName = customerSku.skuName;
        var skuRemark = customerSku.remark;
        var skuQuantity = customerSku.skuQuantity;
        var skuUnitName = customerSku.skuUnitName;
        var ul = document.createElement('ul');

        ul.setAttribute("class", "information informationList compact");
        ul.appendChild(renderSkuCell(null, skuBrandName, "width:10%;"));
        ul.appendChild(renderSkuCell(null, skuName, "width:23%;"));
        ul.appendChild(renderSkuCell(null, skuMode, "width:21%;"));
        ul.appendChild(renderSkuCell(null, skuRemark, "width:27%;"));
        ul.appendChild(renderSkuCell(null, skuQuantity, "width:7%;"));
        ul.appendChild(renderSkuCell(null, skuUnitName, "width:7%;"));
        ul.appendChild(renderSkuCell(null, "无", "width:5%;"));
        return ul;
    }



    //选择sku商品的回调方法
    function chooseSkuCommodityCallback(skuDataList) {
        if (skuDataList) {

            //判断skuCommodityDataList中是否已经存在了skuDataList中的商品
            if (skuCommodityDataList.length != 0) {
                var existSkuIdArray = checkSkuCommodityExist(skuDataList);
                var existSkuIdStr = "";
                if (existSkuIdArray.length > 0) {
                    for (var i = 0; i < existSkuIdArray.length; i++) {
                        if (i != existSkuIdArray.length - 1) {
                            existSkuIdStr = existSkuIdStr + existSkuIdArray[i] + ",";
                        } else {
                            existSkuIdStr = existSkuIdStr + existSkuIdArray[i];
                        }
                    }
                    layer.msg("商品:[" + existSkuIdStr + "]已经添加，请不要重复添加", {icon: 5});
                    return false;
                }
            }

            var length = skuDataList.length;
            var table = document.getElementById("skuTable");
            if (length > 0) {
                for (var i = 0; i < skuDataList.length; i++) {
                    var data = skuDataList[i];
                    skuCommodityDataList.push(data);
                    var row = renderSkuRow(data);
                    table.appendChild(row);
                }
                //渲染单位控制小数位数
                renderUnitDisplay();
            }
        }
        return true;

    }

    //检查skuCommodityDataList中是否已存在了skuDataList中的商品
    function checkSkuCommodityExist(skuDataList) {
        var existSkuIdArray = [];
        if (skuCommodityDataList.length != 0) {
            for (var i = 0; i < skuDataList.length; i++) {
                var preToAddSku = skuDataList[i];
                var preToAddSkuId = preToAddSku.skuId;
                for (var j = 0; j < skuCommodityDataList.length; j++) {
                    var existSku = skuCommodityDataList[j];
                    var existSkuId = existSku.skuId;
                    if (preToAddSkuId == existSkuId) {
                        existSkuIdArray.push(preToAddSkuId);
                        break;
                    }
                }
            }
        }
        return existSkuIdArray;
    }

    function renderSkuRow(rowData) {
        var skuId = rowData.skuId;
        var skuName = rowData.skuName;
        var minnum = rowData.minnum;
        var model = rowData.model;
        var classifyId = rowData.classifyId;
        var classifyName = rowData.classifyName;
        var brandId = rowData.brandId;
        var brandName = rowData.brandName;
        var unitId = rowData.unitId;
        var unitName = rowData.unitName;

        var ul = document.createElement('ul');
        ul.setAttribute("class", "information informationList compact");
        ul.setAttribute("id", "ul_sku_row_" + skuId);

        ul.appendChild(renderSkuCell("skuId", skuId, "width:6%;"));
        ul.appendChild(renderSkuCell(null, brandName, "width:7%;"));
        ul.appendChild(renderSkuCell(null, skuName, "width:26%;"));
        ul.appendChild(renderSkuCell(null, model, "width:15%;"));
        ul.appendChild(renderSkuCell("skuDescirbe", rowData, "width:27%;"));
        ul.appendChild(renderSkuCell("quantity", rowData, "width:7%;"));
        ul.appendChild(renderSkuCell(null, unitName, "width:7%;"));
        ul.appendChild(renderSkuCell("operation", rowData, "width:5%;border-right:none;"));
        return ul;
    }

    function renderSkuCell(name, value, style) {

        var li = document.createElement('li');
        li.setAttribute("style", style)
        var div_mida = document.createElement('div');
        div_mida.setAttribute("class", "mida");
        var div_midb = document.createElement('div');
        div_midb.setAttribute("class", "midb");
        //个性化差异-操作区域
        if ("operation" == name) {
            div_midb.innerHTML = '<p><a href="javascript:void(0);" onclick="removeSkuRow(\'' + value.skuId + '\')">删除</a></p>';
        } else if ("skuDescirbe" == name) {
//            div_midb.innerHTML = '<input type="text" class="fz12 t-c" style="width: 80%; border: none;" maxlength="100" id="skuDescirbes_' + value.skuId + '"  />';
            div_midb.innerHTML = '<textarea class="fz12 t-c" style="width: 80%; border: none;" type="text" placeholder="商品描述" id="skuDescirbes_' + value.skuId + '" ></textarea>';
        } else if ("quantity" == name) {
            div_midb.innerHTML = '<input type="text" class="fz12 t-c unitCheck unitDisplay" unitName="'+value.unitName+'" style="width: 80%; border: none;" id="skuQuantity_' + value.skuId + '"  />';
        } else if ("skuId" == name){
            div_midb.innerHTML = value;
        } else {
            div_midb.innerText = value;
        }
        div_mida.appendChild(div_midb);
        li.appendChild(div_mida);
        return li;
    }

    //移除sku数据
    function removeSkuRow(skuId) {
        if (confirm("确定移除该SKU")) {
            $("#ul_sku_row_" + skuId).remove();
            if (skuCommodityDataList.length > 0) {
                for (var i = 0; i < skuCommodityDataList.length; i++) {
                    var skuCommodityData = skuCommodityDataList[i];
                    var skuCommoditySkuId = skuCommodityData.skuId;
                    if (skuCommoditySkuId == skuId) {
                        skuCommodityDataList.splice(i, 1);
                        break;
                    }
                }
            }
        }
    }

    //全局变量，管理自定义商品的唯一标识
    var customerSkuId = 1;
    var customerSkuCommodityDataList = [];

    function renderCustomerSkuRow() {
        var currentCustomerSkuId = customerSkuId;
        var customerSku = {};
        customerSku.customerSkuId = currentCustomerSkuId;
        customerSkuCommodityDataList.push(customerSku);
        var table = document.getElementById("customSkuTable");
        var ul = document.createElement('ul');
        ul.setAttribute("class", "information informationList compact");
        ul.setAttribute("id", "ul_customer_sku_row_" + currentCustomerSkuId);
        ul.appendChild(renderCustomerSkuCell("customerSkuBrandName", currentCustomerSkuId, "width:10%;"));
        ul.appendChild(renderCustomerSkuCell("customerSkuName", currentCustomerSkuId, "width:23%;"));
        ul.appendChild(renderCustomerSkuCell("customerSkuModel", currentCustomerSkuId, "width:21%;"));
        ul.appendChild(renderCustomerSkuCell("customerSkuDescribe", currentCustomerSkuId, "width:27%;"));
        ul.appendChild(renderCustomerSkuCell("customerSkuQuantity", currentCustomerSkuId, "width:7%;"));
        ul.appendChild(renderCustomerSkuCell("customerSkuUnitName", currentCustomerSkuId, "width:7%;"));
        ul.appendChild(renderCustomerSkuCell("customerSkuOperation", currentCustomerSkuId, "width:5%;"));
        table.appendChild(ul);
        customerSkuId++;
    }

    function renderCustomerSkuCell(name, value, style) {
        var li = document.createElement('li');
        li.setAttribute("style", style)
        var div_mida = document.createElement('div');
        div_mida.setAttribute("class", "mida");
        var div_midb = document.createElement('div');
        div_midb.setAttribute("class", "midb");
        //个性化差异-操作区域
        if ("customerSkuModel" == name) {
            div_midb.innerHTML = '<input type="text" class="fz12 t-c" style="width: 80%; border: none;" placeholder="商品型号" maxlength="100" id="customerSkuModel_' + value + '"  />';
        } else if ("customerSkuBrandName" == name) {
            div_midb.innerHTML = '<input type="text" class="fz12 t-c" style="width: 80%; border: none;" placeholder="商品品牌" maxlength="100" id="customerSkuBrandName_' + value + '"  />';
        } else if ("customerSkuName" == name) {
            div_midb.innerHTML = '<input type="text" class="fz12 t-c" style="width: 80%; border: none;" placeholder="商品名称" maxlength="100" id="customerSkuName_' + value + '"  />';
        } else if ("customerSkuDescribe" == name) {
//            div_midb.innerHTML = '<input type="text" class="fz12 t-c" style="width: 80%; border: none;" placeholder="商品描述" maxlength="100" id="customerSkuDescribe_' + value + '"  />';
            div_midb.innerHTML = '<textarea class="fz12 t-c" style="width: 80%; border: none;" type="text" placeholder="商品描述" id="customerSkuDescribe_' + value + '" ></textarea>';
        } else if ("customerSkuQuantity" == name) {
            div_midb.innerHTML = '<input type="text" class="fz12 t-c num3" style="width: 80%; border: none;" placeholder="商品数量"id="customerSkuQuantity_' + value + '"  />';
        } else if ("customerSkuUnitName" == name) {
            div_midb.innerHTML = '<input type="text" class="fz12 t-c" style="width: 80%; border: none;" placeholder="商品单位" id="customerSkuUnitName_' + value + '"  />';
        } else if ("customerSkuOperation" == name) {
            div_midb.innerHTML = '<p><a href="javascript:void(0);" onclick="removeCustomerSkuRow(\'' + value + '\')">删除</a></p>';
        } else {
            div_midb.innerText = value;
        }

        div_mida.appendChild(div_midb);
        li.appendChild(div_mida);
        return li;
    }

    function removeCustomerSkuRow(skuId) {
        if (confirm("确定移除该自定义商品")) {
            $("#ul_customer_sku_row_" + skuId).remove();
        }
        if (customerSkuCommodityDataList.length > 0) {
            for (var i = 0; i < customerSkuCommodityDataList.length; i++) {
                var customerSkuCommodityData = customerSkuCommodityDataList[i];
                var customerSkuId = customerSkuCommodityData.customerSkuId;
                if (customerSkuId == skuId) {
                    customerSkuCommodityDataList.splice(i, 1);
                    break;
                }
            }
        }
    }
</script>
<#include "/res/freemarkerTpl/unitConfig.html" />
<@unitConfig/>
</body>
</html>
